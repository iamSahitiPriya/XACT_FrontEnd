<div class="row">
  <app-search [dataSource]="dataSource" [columns]="['1','categoryName']" class="col-md-9"></app-search>
  <div class="col-md-3 topicButtonColumn">
    <button mat-flat-button class="topicButton1" (click)="addTopicRow()">
      Add Topic
    </button>
  </div>
</div>
<div class="mat-elevation-z8 topic">
  <table mat-table [dataSource]="dataSource" multiTemplateDataRows aria-describedby="category">
    <ng-container matColumnDef="categoryName">
      <th class="parameter" mat-header-cell *matHeaderCellDef>Category</th>
      <td class="parameter categoryParameter" mat-cell *matCellDef="let row">
      <span *ngIf="!(row.isEdit || selectedParameter === row)">
          <span class="circle"></span>
        {{row.categoryName}}
        </span>
        <span *ngIf="row.isEdit || selectedParameter===row">
          <mat-form-field appearance="outline" class="selectDropdownForm">
                        <mat-label>Select Category</mat-label>
        <mat-select [(ngModel)]="row.categoryName" required>
          <mat-option *ngFor="let category of categoryList" [disabled]="!(category.active)"
                      [value]="category.categoryId" (click)="shortlistModule(category.categoryId)">
            {{category.categoryName}}
          </mat-option>
        </mat-select>
            <mat-error>
              Please fill the field
        </mat-error>
            </mat-form-field>
          <!--          <mat-error *ngIf="!categoryName.value.match('^[a-zA-Z0-9-()._-]+(\\s+[a-zA-Z0-9-()._-]+)*$')">-->
          <!--          {{commonErrorFieldText}}-->
          <!--        </mat-error>-->
        </span>
      </td>
    </ng-container>
    <ng-container matColumnDef="expandedDetail">
      <td mat-cell *matCellDef="let row" [attr.colspan]="displayedColumns.length" class="expandedCommentsData">
        <div [@detailExpand]="row.isEdit === true || row === selectedParameter ? 'expanded' : 'collapsed'"
             class="topicComments">
          <mat-form-field appearance="outline" class="topicCommentTextArea">
            <textarea matInput placeholder="Comments"
                      [(ngModel)]="row.comments"
                      cdkTextareaAutosize
                      cdkAutosizeMinRows="1"
                      cdkAutosizeMaxRows="2"
                      maxlength="1000">

            </textarea>
          </mat-form-field>
        </div>
      </td>
    </ng-container>
    <ng-container matColumnDef="moduleName">
      <th class="parameter Heading" *matHeaderCellDef> Module</th>
      <td class="parameter moduleParameter" *matCellDef="let row">
              <span *ngIf="!(row.isEdit || selectedParameter === row)">
                {{row.moduleName}}
        </span>
        <span *ngIf="row.isEdit || selectedParameter===row">
          <mat-form-field appearance="outline" class="selectDropdownForm">
            <mat-label>Select Module</mat-label>
        <mat-select [(ngModel)]="row.moduleName" class="topicSelector" required>
          <mat-option *ngFor="let module of moduleList" [value]="module.moduleId">
            {{module.moduleName}}
          </mat-option>
        </mat-select>
            <mat-error>
              Please fill the field
        </mat-error>
            </mat-form-field>
        </span>
      </td>
    </ng-container>
    <ng-container matColumnDef="topicName">
      <th class="parameter Heading" mat-header-cell *matHeaderCellDef> Topic</th>
      <td class="parameter topicParameter" mat-cell *matCellDef="let row"> <span *ngIf="!(row.isEdit || selectedParameter === row)">
        {{row.topicName}}
        </span>
        <span *ngIf="row.isEdit || selectedParameter===row">
          <mat-form-field appearance="outline" class="topicInput">
            <mat-label>Enter topic name</mat-label>
          <input matInput #categoryName placeholder="Enter topic name" [(ngModel)]="row.topicName"
                 pattern="^[a-zA-Z0-9-()._-]+(\s+[a-zA-Z0-9-()._-]+)*$">
          <mat-error *ngIf="!categoryName.value.match('^[a-zA-Z0-9-()._-]+(\\s+[a-zA-Z0-9-()._-]+)*$')">
          {{commonErrorFieldText}}
        </mat-error>
            </mat-form-field>
        </span>
      </td>
    </ng-container>
    <ng-container matColumnDef="parameterName">
      <th class="parameter Heading" mat-header-cell *matHeaderCellDef> Parameter</th>
      <td class="parameter parameterName" mat-cell *matCellDef="let row"> <span *ngIf="!(row.isEdit || selectedParameter === row)">
        {{row.parameterName}}
        </span>
      </td>
    </ng-container>
    <ng-container matColumnDef="updatedAt">
      <th class="parameter Heading" mat-header-cell *matHeaderCellDef> Date</th>
      <td class="parameter parameterDate" mat-cell *matCellDef="let row"> {{row.updatedAt | date:'dd-MMM-yyyy'}} </td>
    </ng-container>
    <ng-container matColumnDef="active">
      <th class="parameter" mat-header-cell *matHeaderCellDef> Active</th>
      <td class="parameter parameterActive" mat-cell *matCellDef="let row">
        <mat-slide-toggle [(ngModel)]="row.active"
                          [disabled]="!(selectedParameter === row || row.isEdit)"></mat-slide-toggle>
      </td>
    </ng-container>
    <ng-container matColumnDef="edit">
      <th class="parameter" mat-header-cell *matHeaderCellDef>Action</th>
      <td class="parameter" mat-cell *matCellDef="let row; let index = index;">
        <span *ngIf="!(row.isEdit || selectedParameter === row)">
        <button mat-flat-button class="editButton" aria-label="expand row" (click)="editTopic(row)">Edit</button>
        </span>
        <span *ngIf="selectedParameter===row">
        <button mat-flat-button class="updateButton" aria-label="expand row"
                (click)="updateTopic(row)">Update</button>
        <button class="closeButton" (click)="cancelChanges(row)"> <img data-id="manage"
                                                                       src="../../assets/closeIcon/closeIcon.svg"
                                                                       alt="close icon" class="closeIcon"/></button>
        </span>
        <span *ngIf="row.isEdit">
          <button mat-flat-button class="saveTopicButton" type="submit" (click)="saveTopic(row)">Save</button>
        </span>
      </td>
    </ng-container>
    <ng-container matColumnDef="reference">
      <th class="parameter" mat-header-cell *matHeaderCellDef></th>
      <td class="parameter parameter" mat-cell *matCellDef="let row">
        <button mat-flat-button (click)="deleteAddedTopicRow()" *ngIf="(row.isEdit || selectedParameter === row)">
          <mat-icon id="deleteTopic">delete</mat-icon>
        </button>
        <button mat-flat-button *ngIf="!(row.isEdit || selectedParameter === row)">
          <mat-icon>playlist_add</mat-icon>
        </button>
      </td>
    </ng-container>
    <ng-container>
      <th class="parameter" mat-header-cell *matHeaderCellDef></th>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="topicRow"></tr>
    <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="expandedTopicRow"></tr>
  </table>
  <mat-paginator [pageSizeOptions]="[5, 10, 25, 100,150,200]" aria-label="Select page of users"></mat-paginator>
</div>



