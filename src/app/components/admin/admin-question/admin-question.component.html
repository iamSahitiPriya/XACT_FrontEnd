<mat-card-header class="question-header">
  <div class="question-heading">{{parameter && parameter.parameterName}}</div>
  <div class="close-question" *ngIf="role === 'Admin'">
    <button [matTooltip]=closeToolTip type="button" id="close" (click)="close()">
      <mat-icon class="close-question-icon">close</mat-icon>
    </button>
  </div>
</mat-card-header>
<mat-card-title class="question-status">
  <h2 class="question-heading">{{questions}}</h2>
</mat-card-title>
<div class="admin-questions">
  <div class="question-button-column" *ngIf="role ==='AUTHOR'">
    <button mat-flat-button class="question-button1" (click)="addQuestionRow()">
      {{addQuestion}}
    </button>
    <br>
  </div>
  <div class="questions" *ngIf="questionStatusMapper">
    <div *ngFor="let question of questionStatusMapper | keyvalue ">

      <div class="question-status-heading-content"
           [ngStyle]="{'border-color':statusStyleMapper.get(question.key)?.borderColor, 'background-color':statusStyleMapper.get(question.key)?.backgroundColor}">

        <div class="status-icon">
          <span *ngIf="question.key === sentForReview" class="sent-for-review-and-reassessment"><mat-icon>info-outline</mat-icon></span>
          <span *ngIf="question.key === published" class="published"><mat-icon>check_circle</mat-icon></span>
          <span *ngIf="question.key === requestedForChange" class="sent-for-review-and-reassessment"><mat-icon>warning</mat-icon></span>
          <span *ngIf="question.key === rejected" class="rejected"><mat-icon>close</mat-icon></span>
          <span *ngIf="question.key === draft" class="draft"><mat-icon>create</mat-icon></span>
        </div>

        <div class="question-status-heading">
         {{statusStyleMapper.get(question.key)?.displayText}}
        </div>

      </div>
      <mat-card class="question-card" [ngStyle]="{'border-color':statusStyleMapper.get(question.key)?.borderColor}">
        <mat-card-content class="question-card-content">
          <div *ngFor="let question of question.value, let i=index">
            <div class="question-container">
              <div class="question-text" [ngClass]="{'published-questions': question.status === published || question.status === rejected}">

                <mat-form-field appearance="outline" class="question-input" *ngIf="question.isEdit===true">
                  <mat-label>{{questionText}}</mat-label>
                  <input #input matInput required
                         name="question{{question.questionId}}"
                         id="question{{question.questionId}}"
                         [(ngModel)]="question.questionText"
                         class="input-field"
                         maxlength="2000">
                  <mat-error>
                    {{requiredField}}
                  </mat-error>
                  <mat-hint align="end">{{input.value.length}}/2000</mat-hint>
                </mat-form-field>

                <p *ngIf="question.isEdit===false">{{i + 1}}. {{question.questionText}}</p>
              </div>

              <div class="question-edit-update" *ngIf="question.status !== published">

                <div class="question-comments" *ngIf="question.comments && question.isEdit === false">
                  <mat-icon matTooltip="{{question.comments}}">chat</mat-icon>
                </div>

                <div class="edit-button"
                     *ngIf="((question.status === sentForReview && question.isEdit === false) ||
                                (question.status === 'DRAFT' && question.isEdit === false) ||
                                (question.status === 'REQUESTED_FOR_CHANGE' && question.isEdit === false && role === 'AUTHOR') )">
                  <button class="edit-question" id="edit-question" mat-flat-button
                          [disabled]="question.status === sentForReview && role === 'AUTHOR'"
                          (click)="setIsEdit(question)">{{edit}}</button>
                </div>


                <div class="send-for-review-button"
                     *ngIf="((question.status === 'SENT_FOR_REVIEW' && question.isEdit === false) ||
                               (question.status === 'DRAFT' && question.isEdit === false) ||
                               (question.status === requestedForChange && question.isEdit === false && role === 'AUTHOR') )">

                  <button class="send-question-for-review" id="sent-for-review-question" mat-flat-button
                          [disabled]="question.status === sentForReview && role === 'AUTHOR'"
                          (click)="sendForReview(question,action)">{{contributorActionButtonText}}</button>
                  <div class="delete-button" *ngIf="role === 'AUTHOR'">
                    <button mat-flat-button (click)="deleteQuestion(question)" [ngClass]="{'disable-delete-button' : question.status === 'SENT_FOR_REVIEW'}">
                      <mat-icon id="delete-question">delete</mat-icon>
                    </button>
                  </div>

                  <div>
                    <div></div>
                  </div>
                </div>


                <div class="reviewer-actions"
                     *ngIf="role==='REVIEWER' && question.status === sentForReview && question.isEdit === false">
                  <button class="approve-action">
                    <mat-icon [matTooltip]="'Approve'" (click)="sendForReview(question,'PUBLISHED')">check</mat-icon>
                  </button>
                  <button class="reject-action">
                    <mat-icon [matTooltip]="'Reject'" (click)="sendForReview(question,'REJECTED')">close</mat-icon>
                  </button>
                </div>


                <div class="save-button" *ngIf="question.isEdit === true && question.questionId === defaultQuestionId">
                  <button class="save-question" [disabled]="!question.questionText" mat-flat-button
                          (click)="saveQuestion(question)">{{save}}</button>
                  <div class="delete-question">
                    <button mat-flat-button (click)="removeQuestion()">
                      <mat-icon id="deleteQuestion">delete</mat-icon>
                    </button>
                  </div>
                </div>
                <div class="update-button"
                     *ngIf="question.isEdit === true && question.questionId !== defaultQuestionId">
                  <div>
                    <button class="update-question" mat-flat-button (click)="updateQuestion(question)"
                            [disabled]="!question.questionText">{{update}}</button>
                  </div>
                  <div class="cancel-button">
                    <button class="cancel-button" (click)="cancelChanges(question)">
                      <mat-icon>cancel</mat-icon>
                    </button>
                  </div>
                </div>
              </div>


            </div>
          </div>
        </mat-card-content>
      </mat-card>
      <br>
    </div>
  </div>
</div>
