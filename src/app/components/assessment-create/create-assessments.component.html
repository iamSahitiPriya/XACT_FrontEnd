<!--
  ~ Copyright (c) 2022 - Thoughtworks Inc. All rights reserved.
  -->


<div *ngIf="assessment">
  <form (ngSubmit)="saveAssessment()" [formGroup]="createAssessmentForm">
    <h1 *ngIf="assessment.assessmentId===-1" mat-dialog-title>{{createAssessmentTitle}}</h1>
    <h1 *ngIf="assessment.assessmentId>-1" mat-dialog-title>{{manageAssessmentTitle}}</h1>
    <button [matTooltip]=closeToolTip type="button" id="close" mat-icon-button (click)="close()">
      <mat-icon>close</mat-icon>
    </button>

    <div mat-dialog-content>
      <mat-form-field appearance="outline" class="assessmentName" >
        <mat-label>{{purposeOfAssessmentTitle}} *</mat-label>
        <mat-select  (selectionChange)="purposeChange($event.value)"  required formControlName="selected">
          <mat-option *ngFor="let purpose of purposeOfAssessment" [value]="purpose.value">{{purpose.value}}</mat-option>
        </mat-select>
        <mat-error *ngIf="form['selected'].hasError('required')">
         {{mandatoryFieldText}}
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="assessmentName">
        <mat-label>{{assessmentNameTitle}} *</mat-label>
        <input matInput formControlName="assessmentNameValidator" [placeholder]=assessmentNamePlaceholder required
               [(ngModel)]="assessment.assessmentName" pattern="^[a-zA-Z0-9-()._-]+(\s+[a-zA-Z0-9-()._-]+)*$"
               maxlength="50">
        <mat-error *ngIf="form['assessmentNameValidator'].hasError('required')">
          {{mandatoryFieldText}}
        </mat-error>
        <mat-error *ngIf="form['assessmentNameValidator'].hasError('pattern')">
          {{commonErrorFieldText}}
        </mat-error>
      </mat-form-field>
      <br>

      <mat-form-field appearance="outline" class="domain">
        <mat-label>{{assessmentDomainTitle}} *</mat-label>
        <input matInput [(ngModel)]="assessment.domain" formControlName="domainNameValidator"
               [placeholder]=assessmentDomainPlaceholder required
               pattern="^[a-zA-Z0-9-()._-]+(\s+[a-zA-Z0-9-()._-]+)*$" maxlength="50">
        <mat-error *ngIf="form['domainNameValidator'].hasError('required')">
          {{mandatoryFieldText}}
        </mat-error>
        <mat-error *ngIf="form['domainNameValidator'].hasError('pattern')">
          {{commonErrorFieldText}}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="teamSize">
        <mat-label>{{assessmentTeamTitle}} *</mat-label>
        <input type="number" [(ngModel)]="assessment.teamSize" matInput formControlName="teamSizeValidator"
               [placeholder]=assessmentTeamPlaceholder min="1" max="10000000" required pattern="^[1-9]\d*$">
        <mat-error *ngIf="form['teamSizeValidator'].hasError('required')">
          {{mandatoryNumberField}}
        </mat-error>
        <mat-error *ngIf="form['teamSizeValidator'].hasError('pattern')">
          {{numberErrorField}}
        </mat-error>
      </mat-form-field>
      <br>

      <mat-form-field appearance="outline" class="organizationName">
        <mat-label>{{organisationNameTitle}} *</mat-label>
<!--        <input class="colorClass" matInput [(ngModel)]="assessment.organisationName"-->
<!--               formControlName="organizationNameValidator"-->
<!--               [placeholder]=organisationNamePlaceholder required pattern="^[a-zA-Z0-9-()._-]+(\s+[a-zA-Z0-9-()._-]+)*$"-->
<!--               maxlength="50">-->
        <input type="text"
               [placeholder]=organisationNamePlaceholder
               aria-label="Number"
               matInput
               [(ngModel)]="assessment.organisationName"
               [formControl]="myControl"
               formControlName="organizationNameValidator"
               (input)="change()"
               [matAutocomplete]="auto">
        <mat-autocomplete #auto="matAutocomplete" >
          <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
            {{option}}
          </mat-option>
        </mat-autocomplete>

        <div *ngIf="nameCheck">
        <mat-error *ngFor="let validation of validation_msgs.myControl">
          <div *ngIf="myControl.hasError(validation.type)">
            {{validation.message}}
          </div>
        </mat-error>
        </div>
        <mat-error *ngIf="form['organizationNameValidator'].hasError('required')">
          {{mandatoryFieldText}}
        </mat-error>
<!--        <mat-error *ngIf="form['myControl'].hasError('required')">-->
<!--         Choose Options From Dropdown-->
<!--        </mat-error>-->
<!--        <span *ngIf="nameCheck">Errorrrr</span>-->

      </mat-form-field>
      <br>

      <mat-form-field appearance="outline" class="industry">
        <mat-label>{{organisationIndustryTitle}} *</mat-label>
        <input matInput [(ngModel)]="assessment.industry" formControlName="industryValidator"
               [placeholder]=organisationIndustryPlaceholder
               required pattern="^[a-zA-Z0-9-()._-]+(\s+[a-zA-Z0-9-()._-]+)*$" maxlength="50">
        <mat-error *ngIf="form['industryValidator'].hasError('required')">
          {{mandatoryFieldText}}
        </mat-error>
        <mat-error *ngIf="form['industryValidator'].hasError('pattern')">
          {{commonErrorFieldText}}
        </mat-error>
      </mat-form-field>&nbsp;&nbsp;

    </div>

    <h2 mat-dialog-title>{{addAssessmentUsers}} </h2>
    <div mat-dialog-content>
      <mat-form-field appearance="outline" class="addUserEmail">
        <mat-label>{{userEmailTitle}}</mat-label>
        <mat-chip-list #chipList aria-label="Email Selection">
          <mat-chip *ngFor="let email of emails" (removed)="remove(email)">
            {{email}}
            <button matChipRemove>
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
          <input matInput type="text"
                 [placeholder]=userEmailPlaceholder
                 formControlName="emailValidator"
                 id="userEmails" maxlength="1200"
                 [matChipInputFor]="chipList"
                 [matChipInputAddOnBlur]="addOnBlur"
                 [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                 (matChipInputTokenEnd)="add($event)"
                 [(ngModel)]="emailTextField">
        </mat-chip-list>
      </mat-form-field>
      <mat-error *ngIf="form['emailValidator'].hasError('pattern')" style="margin-top:-10px;margin-left:17px">
        {{userEmailErrorMessage}}
      </mat-error>
    </div>
    <button [matTooltip]=createAssessmentToolTip *ngIf="assessment.assessmentId===-1" type="submit" mat-raised-button
            class="saveButton" [class.spinner]="loading" [disabled]="loading">{{createAssessmentButtonText}}
    </button>
    <button [matTooltip]=manageAssessmentToolTip *ngIf="assessment.assessmentId>-1" type="submit" mat-raised-button
            class="saveButton" [class.spinner]="loading" [disabled]="loading"
            (click)="updateAssessment()">{{manageAssessmentButtonText}}
    </button>
  </form>
  <div></div>
</div>
<div></div>

